<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
    <div id=container style="width: 100%; height: 100vh">
      <div id="scene" style="
      width: 100%;
      height: 100%">
      </div>

    </div>
		<script>
      // Our Javascript will go here.
      const scene = new THREE.Scene();
 
      //Add Renderer
      const renderer = new THREE.WebGLRenderer();
      var container = document.getElementById('scene');
      var w = container.offsetWidth;
      var h = container.offsetHeight;
      renderer.setSize(w, h);
      container.appendChild(renderer.domElement);
      const camera = new THREE.PerspectiveCamera( 60, w / h, 0.1, 10000 );

      //Geometries
      const puckCylinder = new THREE.CylinderGeometry( 30, 30, 20, 8, 2 );
      const puckCoreCylinder = new THREE.CylinderGeometry( 28, 28, 18, 8, 2 );
      const tableGeometry = new THREE.BoxGeometry( 600, 100, 4500, 10, 2, 60  );
      const tableCoreGeometry = new THREE.BoxGeometry( 598, 98, 4498 );
      const puckPointerGeo = new THREE.CylinderGeometry( 20, 5, 80, 8, 2 );

      const tableWireframe = new THREE.WireframeGeometry( tableGeometry );

      //Materials
      const bpMaterial = new THREE.MeshBasicMaterial( {color: 0x03b1fc, wireframe: true} );
      const puckPointerMaterial = new THREE.MeshBasicMaterial( {color: 0xffff00, wireframe: true} );

      const rpMaterial = new THREE.MeshBasicMaterial( {color: 0xfc0352, wireframe: true} );

      const tableCoreMat = new THREE.MeshPhongMaterial( {color: 0x002200} );
      const bpCoreMat = new THREE.MeshPhongMaterial( {color: 0x03b1fc} );

      

      const table = new THREE.LineSegments( tableWireframe );
      table.material.depthTest = false;
      table.material.opacity = .1;
      table.material.transparent = true;

      //Meshes

      const puckPointer = new THREE.Mesh( puckPointerGeo, puckPointerMaterial );

      var bp1 = new THREE.Group();
        bp1.add( new THREE.Mesh( puckCylinder, bpMaterial ) );
        bp1.add( new THREE.Mesh( puckCoreCylinder, bpCoreMat ) );
      // const bp1 = new THREE.Mesh( puckCylinder, bpMaterial );
      const bp2 = new THREE.Mesh( puckCylinder, bpMaterial );
      const bp3 = new THREE.Mesh( puckCylinder, bpMaterial );
      const bp4 = new THREE.Mesh( puckCylinder, bpMaterial );

      const rp1 = new THREE.Mesh( puckCylinder, rpMaterial );
      const rp2 = new THREE.Mesh( puckCylinder, rpMaterial );
      const rp3 = new THREE.Mesh( puckCylinder, rpMaterial );
      const rp4 = new THREE.Mesh( puckCylinder, rpMaterial );

      const tableCore = new THREE.Mesh( tableCoreGeometry, tableCoreMat );

      //Lighting
      const lightAmb = new THREE.AmbientLight( 0x404040 ); // soft white light
      const lightPoint = new THREE.PointLight( 0xffffff, .6, 100000, 2 );
      const directionalLight = new THREE.SpotLight( 0xffffff, 0.5 );
      scene.add( directionalLight );
      scene.add( lightPoint );
      lightPoint.position.set( -1000, 550, -2250 );
      scene.add( lightAmb );
 




      //Camera
      camera.position.x = 1700;
      camera.position.y = 1000;
      camera.position.z = 0;
      camera.lookAt(300, -200, 1200);

      //Scene
      scene.add( table );
      scene.add( puckPointer );
      scene.add( tableCore );
      scene.add(bp1, bp2, bp3, bp4, rp1, rp2, rp3, rp4 );


      bp1.position.set(10000, 0, 0);
      bp2.position.set(10000, 0, 0);
      bp3.position.set(10000, 0, 0);
      bp4.position.set(10000, 0, 0);

      rp1.position.set(10000, 0, 0);
      rp2.position.set(10000, 0, 0);
      rp3.position.set(10000, 0, 0);
      rp4.position.set(10000, 0, 0);

      table.position.set(300, -50, 2250);
      tableCore.position.set(299, -49, 2249);





      //Anitmation
      function animate() {
        
        
        requestAnimationFrame( animate );
        
        bp1.position.set(10000, 0, 0);
        bp2.position.set(10000, 0, 0);
        bp3.position.set(10000, 0, 0);
        bp4.position.set(10000, 0, 0);

        rp1.position.set(10000, 0, 0);
        rp2.position.set(10000, 0, 0);
        rp3.position.set(10000, 0, 0);
        rp4.position.set(10000, 0, 0);
        
        const bpBest = [];
        const rpBest = [];
        


        let bpJSON = true;
        // let bpJSON = component.bluePucks;

        if (bpJSON) {
          // const bpObj = JSON.parse(bpJSON);
          const bpObj = {"locations":[{"puck":[68,10,1]},{"puck":[68,520,1]},{"puck":[18,220,1]},{"puck":[10,890,1]}]};

          const bpxv = [];
          const bpyv = [];
          
          for (let i = 0; i < bpObj.locations.length; i++) {
            var bpx = 0;
            var bpy = 0;
            bpx = bpObj.locations[i].puck[0];
            bpy = bpObj.locations[i].puck[1];
            if (i == 0){
              bp1.position.set(bpx, 10, bpy);
            }
            if (i == 1){
              bp2.position.set(bpx, 10, bpy);
            }
            if (i == 2){
              bp3.position.set(bpx, 10, bpy);
            }
            if (i == 3){
              bp4.position.set(bpx, 10, bpy);
            }
            bpxv.push(bpx);
            bpyv.push(bpy);
          } 

          //add arrow to best red shot
          console.log(bpyv);
          const bplowY = Math.min(...bpyv);
          const bplowYindex = bpyv.indexOf(bplowY);

          const bplowX = bpxv[bplowYindex];
          // console.log(bplowX);
          // console.log(bplowY);
          bpBest.push(bplowX);
          bpBest.push(bplowY);

          
        }

        let rpJSON = true;
        // let rpJSON = component.redPucks;

        if (rpJSON) {
          // const rpObj = JSON.parse(rpJSON);
          const rpObj = {"locations":[{"puck":[68,420,1]},{"puck":[18,120,1]},{"puck":[10,390,1]}]};

          const rpxv = [];
          const rpyv = [];

          for (let i = 0; i < rpObj.locations.length; i++) {
            var rpx = 0;
            var rpy = 0;
            rpx = rpObj.locations[i].puck[0];
            rpy = rpObj.locations[i].puck[1];
            if (i == 0){
              rp1.position.set(rpx, 10, rpy);
            }
            if (i == 1){
              rp2.position.set(rpx, 10, rpy);
            }
            if (i == 2){
              rp3.position.set(rpx, 10, rpy);
            }
            if (i == 3){
              rp4.position.set(rpx, 10, rpy);
            }
            rpxv.push(rpx);
            rpyv.push(rpy);
          } 

          //add arrow to best red shot
          console.log(rpyv);
          const lowY = Math.min(...rpyv);
          const lowYindex = rpyv.indexOf(lowY);

          const lowX = rpxv[lowYindex];

          rpBest.push(lowX);
          rpBest.push(lowY);

          
          // console.log(lowX);
          // console.log(lowY);

        }
        console.log(rpBest);
        console.log(bpBest);

        if (rpBest[1]<bpBest[1]){
          puckPointer.position.set(rpBest[0], 80, rpBest[1]);
        }

        else{
          puckPointer.position.set(bpBest[0], 80, bpBest[1]);
        }


        

        renderer.render( scene, camera );
      }
      animate();

		</script>
	</body>
</html>